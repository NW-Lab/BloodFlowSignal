# BloodFlowSignal

複数の非侵襲的センサーを用いて、体のあちこちの心拍と血流動態を測定し、血管の状態を評価するプロジェクトです。

## プロジェクト概要

このプロジェクトは、光電式PPD（Photoplethysmography）の課題を克服し、より詳細な血管情報を取得することを目的としています。複数の異なるセンサー技術を同時に検証し、各手法の利点と欠点を比較することで、最適な血流測定システムの構築を目指します。

### 主な目標

1. **複数部位での心拍測定**: 体のあちこち（胸部、腹部、頸部、腕、脚など）で同時に心拍を測定
2. **血管硬化度の評価**: 脈波伝播速度（PWV）から血管の弾性を定量化
3. **血流動態の推定**: 複数の測定手法から血流速度と血流分布を推定
4. **光電式PPDの代替・比較**: 測定部位の制限やノイズの問題を解決

## センサー構成

本プロジェクトでは、3種類の異なるセンサー技術を実装・比較します。

### 1. マイク方式（MEMS マイクモジュール）

**製品**: [高感度ＭＥＭＳマイクモジュール SPM0404HE5H-T](https://akizukidenshi.com/catalog/g/g103200/)

**特性**:
- 周波数帯域: 100 Hz ～ 10 kHz
- 感度: -42 dBV/Pa
- 小型モジュール設計

**測定対象**:
- 心音（心臓の音）
- 呼吸音
- 体内音による圧力変化

**利点**:
- 聴診器の原理に最も近い
- 心音の周波数特性を詳細に取得可能
- 比較的安価

**欠点**:
- 周囲のノイズに敏感
- ハウジング設計（遮音性）が重要
- 増幅回路が必須

### 2. 圧力センサー方式（ピエゾ抵抗式力センサー）

**製品**: [ピエゾ抵抗式力センサー FSR402](https://akizukidenshi.com/catalog/g/g106078/)

**特性**:
- 測定範囲: 0～10 N
- 応答速度: 高速（音響測定に対応）
- 感圧抵抗型

**測定対象**:
- 体表面の脈動（機械的振動）
- 脈波伝播速度（PWV）
- 脈波形状

**利点**:
- 複数部位の同期測定が容易
- 脈波伝播速度の直接測定が可能
- 環境光の影響を受けない
- 低消費電力

**欠点**:
- ポイント測定のため複数センサーが必要
- 信号処理が必要

### 3. 光学式センサー方式（光電式PPG）

**製品**: [光学式脈波センサーモジュール](https://akizukidenshi.com/catalog/g/g116107/)

**特性**:
- 赤外線LED と フォトダイオード
- 非侵襲的な血流測定
- 従来の光電式PPD

**測定対象**:
- 血液容積の変化
- 脈拍数
- 血流の相対的な変化

**利点**:
- 従来の標準的な方法
- 実装が比較的簡単
- 脈拍数の直接測定

**欠点**:
- 測定部位が限定（指先、手首など）
- 皮膚色や厚さの影響を受けやすい
- ノイズが大きい

## システムアーキテクチャ

```
┌─────────────────────────────────────────────────────┐
│           複数部位センサー配置                        │
├─────────────────────────────────────────────────────┤
│ 胸部     │ 腹部     │ 頸部     │ 腕部     │ 脚部     │
│ (心臓)   │ (大動脈) │ (頸動脈) │ (上腕)   │ (大腿)   │
├─────────────────────────────────────────────────────┤
│ マイク   │ 圧力     │ 光学式   │ 圧力     │ 圧力     │
│ 圧力     │ センサー │ センサー │ センサー │ センサー │
│ 光学式   │          │          │          │          │
└─────────────────────────────────────────────────────┘
         ↓
┌─────────────────────────────────────────────────────┐
│         マイコン（Arduino / ESP32）                  │
│  ├─ アナログ入力処理                                │
│  ├─ デジタル入力処理（SPI）                         │
│  ├─ 信号フィルタリング                              │
│  ├─ ピーク検出                                      │
│  ├─ PWV計算                                        │
│  └─ データ出力                                      │
└─────────────────────────────────────────────────────┘
         ↓
┌─────────────────────────────────────────────────────┐
│         データ処理・可視化                            │
│  ├─ リアルタイムグラフ表示                          │
│  ├─ PWV分析                                        │
│  ├─ 血管硬化度評価                                  │
│  └─ ログ記録                                        │
└─────────────────────────────────────────────────────┘
```

## 主な測定指標

### 1. 脈波伝播速度（PWV: Pulse Wave Velocity）

複数部位での脈波到達時間差から計算：

```
PWV = 距離（m） / 時間差（s）
```

**評価基準**:
- 若い血管: PWV ≈ 15 m/s
- 硬化血管: PWV > 25 m/s

### 2. 血管コンプライアンス（DC: Distensibility Coefficient）

Bramwell-Hill方程式から計算：

```
cPWV = 1/√(ρ × DC)
```

血管の弾性を定量化。

### 3. 脈波形状解析

- 脈波の立ち上がり時間
- ピーク位置
- 脈波の幅
- 反射波の検出

### 4. 血流速度推定

複数センサーからの信号を統合して、血流速度を間接的に推定。

## ディレクトリ構成

```
BloodFlowSignal/
├── README.md                          # このファイル
├── docs/                              # ドキュメント
│   ├── sensor_specifications.md       # センサー仕様書
│   ├── measurement_protocol.md        # 測定プロトコル
│   ├── data_analysis.md               # データ分析方法
│   └── theory.md                      # 理論的背景
├── hardware/                          # ハードウェア設計
│   ├── schematics/                    # 回路図
│   ├── 3d_models/                     # 3Dプリンタ用モデル
│   └── bom.md                         # 部品表
├── firmware/                          # マイコンファームウェア
│   ├── arduino/                       # Arduino用コード
│   ├── esp32/                         # ESP32用コード
│   └── libraries/                     # 必要なライブラリ
├── software/                          # データ処理・可視化ソフト
│   ├── python/                        # Python処理スクリプト
│   ├── visualization/                 # グラフ表示
│   └── analysis/                      # 分析ツール
├── data/                              # 測定データ
│   ├── raw/                           # 生データ
│   ├── processed/                     # 処理済みデータ
│   └── results/                       # 分析結果
└── tests/                             # テストコード
    ├── unit_tests/
    ├── integration_tests/
    └── validation/
```

## クイックスタート

### 必要な部品

**センサー**:
- MEMS マイクモジュール（SPM0404HE5H-T）
- ピエゾ抵抗式力センサー（FSR402） × 5～10個
- 光学式脈波センサーモジュール

**マイコン**:
- Arduino Uno / Nano / Mega
- または ESP32

**その他**:
- ブレッドボード
- ジャンパーワイヤ
- 抵抗・コンデンサ
- 3Dプリンタ用樹脂（外装製作用）

### セットアップ手順

1. **ハードウェアの組立**
   - センサーをマイコンに接続
   - 外装（3Dプリンタ製）に組み込む

2. **ファームウェアの書き込み**
   ```bash
   cd firmware/arduino
   # Arduino IDEで対応するスケッチを開いて書き込み
   ```

3. **ソフトウェアのセットアップ**
   ```bash
   cd software/python
   pip install -r requirements.txt
   ```

4. **初期測定**
   ```bash
   python main.py
   ```

## 測定方法

### 基本的な測定プロトコル

1. **準備**
   - センサーを各部位に装着
   - 安定した姿勢で5分間休息

2. **測定**
   - 各部位で同時に脈波を記録（最低1分間）
   - 複数回測定（3～5回）

3. **分析**
   - 脈波のピーク検出
   - 部位間の時間差計算
   - PWV計算

4. **評価**
   - 血管硬化度の判定
   - 異常値の検出

## 期待される成果

### 短期的（1～3ヶ月）

- 各センサーの基本動作確認
- 信号処理アルゴリズムの開発
- 複数部位測定の実装

### 中期的（3～6ヶ月）

- PWV測定の精度検証
- 血管評価アルゴリズムの構築
- 複数センサーの統合分析

### 長期的（6～12ヶ月）

- 臨床データとの比較検証
- 機械学習による高度な分析
- 製品化への検討

## 技術的な課題と対応

### 1. ノイズ対策

**マイク方式**:
- ハウジング設計による遮音
- デジタルフィルタリング

**圧力センサー方式**:
- 低域フィルタ
- 移動平均フィルタ

**光学式方式**:
- 環境光補正
- 適応フィルタ

### 2. センサー同期

- タイムスタンプの正確な記録
- クロック同期メカニズム

### 3. 温度補正

- 各センサーの温度特性を測定
- 温度補正アルゴリズムの実装

### 4. 個人差への対応

- 体格に応じた距離補正
- 個人別のキャリブレーション

## 参考文献

- Pulse Wave Velocity: Methodology, Clinical Applications, and Interplay with Heart Rate Variability (PMC11317333)
- Transmissive-detected laser speckle contrast imaging for blood flow monitoring (Nature Light: Science & Applications)
- Pulse transit time estimation of aortic pulse wave velocity (PLoS Computational Biology)

## ライセンス

MIT License

## 貢献

このプロジェクトへの貢献を歓迎します。以下の方法で参加できます。

1. フォークしてブランチを作成
2. 変更をコミット
3. プルリクエストを送信

## 連絡先

プロジェクトに関する質問や提案は、GitHubのIssuesで報告してください。

## 更新履歴

- 2026-01-02: プロジェクト初期化、README作成

---

**注意**: このプロジェクトは研究・開発目的です。医療診断目的での使用は、適切な検証と認可を得た後に行ってください。
