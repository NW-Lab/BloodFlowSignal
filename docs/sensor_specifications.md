# センサー仕様書

## 1. MEMS マイクモジュール（SPM0404HE5H-T）

### 基本仕様

| 項目 | 仕様 |
|------|------|
| 製品名 | 高感度ＭＥＭＳマイクモジュール |
| 型番 | SPM0404HE5H-T |
| 周波数帯域 | 100 Hz ～ 10 kHz |
| 感度 | -42 dBV/Pa |
| パッケージ | BGA |
| 供給電圧 | 1.5 V ～ 3.6 V |
| 消費電流 | 約 0.5 mA |

### 特性

- **周波数特性**: 100 Hz から 10 kHz の範囲で良好な感度
- **心音周波数帯域**: 20 Hz ～ 650 Hz をカバー（100 Hz 以上）
- **呼吸音周波数帯域**: 100 Hz ～ 1000 Hz をカバー
- **小型**: 5.0 mm × 3.0 mm × 1.2 mm

### 接続方法

```
VDD -----> 電源（1.5V～3.6V）
GND -----> グラウンド
OUT -----> オーディオ出力（アナログ）
```

### 使用上の注意

1. **ハウジング設計が重要**: 周囲のノイズを遮断するため、マイクを密閉容器に収める
2. **増幅回路が必須**: マイクからの出力は非常に微弱なため、オペアンプで増幅が必要
3. **ノイズフィルタリング**: デジタルフィルタリングで環境ノイズを除去

### 測定対象

- 心音（心臓の音）
- 呼吸音
- 体内音による圧力変化

---

## 2. ピエゾ抵抗式力センサー（FSR402）

### 基本仕様

| 項目 | 仕様 |
|------|------|
| 製品名 | ピエゾ抵抗式力センサー |
| 型番 | FSR402 |
| 測定範囲 | 0～10 N |
| 感度 | 圧力依存（非線形） |
| 応答時間 | < 1 ms |
| パッケージ | 円形（直径 12.7 mm） |
| 供給電圧 | 5 V |

### 特性

- **応答速度**: 0.8 ms（脈波測定に十分）
- **周波数帯域**: 約 1.25 kHz（心音・呼吸音をカバー）
- **非線形特性**: 圧力が増加するほど抵抗値が低下
- **温度特性**: 温度による変化あり（補正が必要）

### 接続方法

```
FSR402を分圧回路で使用：

        5V
        |
        R（10kΩ）
        |
    +---+----> ADC入力
    |
   FSR402
    |
   GND
```

### 使用上の注意

1. **分圧回路が必須**: FSR402は可変抵抗のため、分圧回路で電圧に変換
2. **温度補正**: 温度による特性変化を補正
3. **キャリブレーション**: 個別のキャリブレーションが必要
4. **複数個使用**: 複数部位測定には複数個のセンサーが必要

### 測定対象

- 体表面の脈動（機械的振動）
- 脈波伝播速度（PWV）
- 脈波形状

---

## 3. 光学式脈波センサーモジュール

### 基本仕様

| 項目 | 仕様 |
|------|------|
| 製品名 | 光学式脈波センサーモジュール |
| 型番 | （確認中） |
| 光源 | 赤外線LED（660 nm または 940 nm） |
| 検出器 | フォトダイオード |
| 周波数帯域 | DC ～ 数 kHz |
| 供給電圧 | 3.3 V ～ 5 V |
| 消費電流 | 約 10～20 mA |

### 特性

- **非侵襲的**: 皮膚表面の血流を光学的に測定
- **脈拍検出**: 血液容積の変化から脈拍を検出
- **相対測定**: 絶対的な血流量ではなく、相対的な変化を測定

### 接続方法

```
LED+ -----> 電源（制限抵抗経由）
LED- -----> GND
PD+ -----> アナログ入力（増幅回路経由）
PD- -----> GND
```

### 使用上の注意

1. **測定部位の限定**: 指先、手首など、光が透過する部位のみ
2. **皮膚色の影響**: メラニン色素が多い場合、信号が弱くなる
3. **環境光の影響**: 外部光源の変動が測定値に影響
4. **密着性が重要**: センサーと皮膚の密着度が測定精度に影響

### 測定対象

- 血液容積の変化
- 脈拍数
- 血流の相対的な変化

---

## センサー比較表

| 特性 | マイク | 圧力センサー | 光学式 |
|------|--------|----------|--------|
| **周波数帯域** | 100 Hz ～ 10 kHz | DC ～ 1.25 kHz | DC ～ 数 kHz |
| **応答速度** | 高速 | 高速（< 1 ms） | 中速 |
| **測定部位** | 任意 | 任意 | 限定（指先など） |
| **ノイズ耐性** | 低 | 高 | 中 |
| **環境光影響** | なし | なし | あり |
| **複数部位対応** | 容易 | 容易 | 困難 |
| **コスト** | 低 | 低 | 低 |
| **実装難易度** | 中 | 低 | 低 |

---

## 信号処理フロー

### マイク方式

```
マイク出力
  ↓
増幅回路
  ↓
ADC変換
  ↓
デジタルフィルタリング（ハイパスフィルタ）
  ↓
周波数解析（FFT）
  ↓
心音検出・分析
```

### 圧力センサー方式

```
FSR402出力
  ↓
分圧回路
  ↓
ADC変換
  ↓
デジタルフィルタリング（ローパス＋ハイパス）
  ↓
ピーク検出
  ↓
時間差計算
  ↓
PWV計算
```

### 光学式方式

```
フォトダイオード出力
  ↓
増幅回路
  ↓
ADC変換
  ↓
デジタルフィルタリング
  ↓
ピーク検出
  ↓
脈拍数計算
```

---

## キャリブレーション方法

### マイク方式

1. 既知の周波数信号を入力
2. 出力の周波数特性を測定
3. 補正係数を計算

### 圧力センサー方式

1. 既知の圧力を加える
2. 出力電圧を測定
3. 圧力-電圧特性曲線を作成
4. 非線形補正を実装

### 光学式方式

1. 既知の脈拍数で測定
2. 検出された脈拍数と比較
3. 補正係数を計算

---

## トラブルシューティング

### マイク方式

| 問題 | 原因 | 対策 |
|------|------|------|
| 出力が小さい | 増幅不足 | 増幅回路のゲインを上げる |
| ノイズが多い | 外部ノイズ | ハウジング改善、フィルタ強化 |
| 周波数特性が悪い | フィルタ設定 | フィルタ係数を調整 |

### 圧力センサー方式

| 問題 | 原因 | 対策 |
|------|------|------|
| 出力が不安定 | 接触不良 | センサー接触面を確認 |
| 温度ドリフト | 温度変化 | 温度補正を実装 |
| 非線形性 | センサー特性 | 非線形補正を実装 |

### 光学式方式

| 問題 | 原因 | 対策 |
|------|------|------|
| 信号が弱い | 皮膚色 | LED電流を増加 |
| ノイズが多い | 環境光 | 環境光補正を実装 |
| 脈拍検出失敗 | 密着不良 | センサー装着を改善 |

---

## 参考資料

- SPM0404HE5H-T データシート
- FSR402 データシート
- 光学式脈波センサー仕様書

