# Project2: M5AtomS3とICS-43434マイクによる血流計測

## 1. はじめに

本プロジェクトは、M5Stack社のM5AtomS3とTDK InvenSense社のICS-43434 MEMSマイクを使用して、血流音を非侵襲的に計測するシステムの構築を目的とします。取得したデータはPC上のシリアルプロッターでリアルタイムに可視化し、心拍などの生体情報の簡易的なモニタリングを目指します。

## 2. 使用機材

本プロジェクトで使用する主要なハードウェアは以下の通りです。

| 機材名 | メーカー | モデル | 概要 |
| :--- | :--- | :--- | :--- |
| マイコン | M5Stack | M5AtomS3 | ESP32-S3を搭載した小型マイコンモジュール [1] |
| マイク | TDK InvenSense | ICS-43434 | I2Sデジタル出力対応のMEMSマイク [2] |

### M5AtomS3

M5AtomS3は、Wi-Fi機能を内蔵した強力なESP32-S3プロセッサ、8MBのフラッシュメモリ、0.85インチのIPSスクリーンを搭載した、非常にコンパクトで多機能な開発モジュールです。USB-Cポート経由での給電とプログラム書き込みが可能で、プロトタイピングに最適です。

### ICS-43434 MEMSマイク

ICS-43434は、高感度かつ低ノイズなデジタルMEMSマイクです。I2Sインターフェースを通じて24ビットのデジタルオーディオデータを出力するため、アナログ回路の設計が不要で、ノイズの影響を受けにくいクリーンな音声信号を取得できます。本プロジェクトでは、このマイクを用いて皮膚表面の微弱な血流音を捉えます。

## 3. ハードウェア接続

M5AtomS3とICS-43434マイクは、以下の表と配線図に従ってI2Sインターフェースで接続します。

| M5AtomS3 Pin | ICS-43434 Pin | 信号名 | 役割 |
| :--- | :--- | :--- | :--- |
| G5 | SCK | I2S Serial Clock | I2Sのビットクロック |
| G6 | WS | I2S Word Select | 左右チャンネルの選択クロック |
| G7 | SD | I2S Serial Data | マイクからのデジタル音声データ |
| 3V3 | VIN | Power | マイクへの電源供給 (3.3V) |
| GND | GND | Ground | グランド接続 |
| GND | SEL | Channel Select | チャンネル選択（GNDに接続してLeftチャンネルに設定） |


## 4. ソフトウェア

開発環境としてArduino IDEを使用し、M5AtomS3にプログラムを書き込みます。取得したデータは、USBシリアル通信を介してPCに送信され、Arduino IDEに標準で搭載されている「シリアルプロッター」機能を用いてリアルタイムで波形を可視化します。

## 5. 測定原理

手首や首などの皮膚表面に近い動脈の拍動は、微弱な音（血流音）を発生させます。ICS-43434マイクは、この音を捉えるのに十分な感度と周波数特性（50Hz〜15kHz）を持っています。取得した音声データから、心拍に同期した周期的な信号を検出することで、心拍数を推定することが可能になります。

## 6. 今後の展望

本プロジェクトで構築したシステムを基盤として、将来的には以下の様な機能拡張が考えられます。

*   **FFT（高速フーリエ変換）による周波数解析**: 血流音の周波数成分を分析し、より詳細な生体情報を抽出します。
*   **心拍数（BPM）の自動計算**: 検出した波形からピークを検出し、リアルタイムで心拍数を計算・表示します。
*   **データの保存と分析**: 計測データをファイルに保存し、長期的な健康状態のモニタリングや、機械学習を用いた異常検知などに応用します。

## 7. 参考文献

[1] M5Stack. (n.d.). *AtomS3*. M5Stack Documentation. Retrieved from https://docs.m5stack.com/en/core/AtomS3
[2] Adafruit Industries. (n.d.). *Adafruit I2S MEMS Microphone Breakout - ICS-43434*. Retrieved from https://www.adafruit.com/product/6049


## 8. 3Dプリント用ケース

血流計測の精度を向上させるため、ICS-43434マイクを皮膚に直接当てるための専用ケースを設計しました。

### ケースの特徴

*   **直接接触型**: マイクの音孔が皮膚に直接当たる構造で、振動を効率的に伝達
*   **遮音設計**: 周囲の環境音を遮断し、血流音のみを捉える
*   **持ちやすい形状**: 円筒形の持ち手で安定した測定が可能
*   **調整可能な設計**: STEP形式ファイルでFusion 360による編集が可能

### CADファイル

`CAD/`ディレクトリに以下のファイルが含まれています：

*   `microphone_case.stl` - 3Dプリント用（ケース本体）
*   `microphone_case.step` - Fusion 360編集用（ケース本体）
*   `microphone_lid.stl` - 3Dプリント用（マイク固定蓋）
*   `microphone_lid.step` - Fusion 360編集用（マイク固定蓋）

詳細な使用方法と設計仕様については、[CAD/README.md](CAD/README.md)を参照してください。

### 3Dプリント推奨設定

*   材質: PLA または ABS
*   積層ピッチ: 0.2mm
*   インフィル: 20-30%
*   プリント方向: 底面を下にして配置
